
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Uncertainty in QSAR modeling &#8212; ml_uncertainty 0.1.1 documentation</title>
    <link rel="stylesheet" href="_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="https://pages.nist.gov/nist-header-footer/css/nist-combined.css" />
    <link rel="stylesheet" type="text/css" href="https://pages.nist.gov/leaveNotice/css/jquery.leaveNotice.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script type="text/javascript" src="https://pages.nist.gov/nist-header-footer/js/jquery-1.9.0.min.js"></script>
    <script type="text/javascript" src="https://pages.nist.gov/nist-header-footer/js/nist-header-footer.js"></script>
    <script id="_fed_an_ua_tag" type="text/javascript" src="https://dap.digitalgov.gov/Universal-Federated-Analytics-Min.js?agency=NIST&subagency=github&pua=UA-42404149-54&yt=true&exts=ppsx,pps,f90,sch,rtf,wrl,txz,m1v,xlsm,msi,xsd,f,tif,eps,mpg,xml,pl,xlt,c"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery.1.12.4.min.js"></script>
    <script type="text/javascript" src="https://pages.nist.gov/leaveNotice/js/jquery.leaveNotice-nist.min.js"></script>
    <script type="text/javascript" src="_static/leave_notice.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Uncertainty in biomarker identification" href="run_environmental_pls-Copy1.html" />
    <link rel="prev" title="Example linear regression (2nd-order polynomial)" href="toy_regression_object-oriented_2nd_order.html" /> 
  </head><body>
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="index.html">ml_uncertainty 0.1.1 documentation</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="toy_regression_object-oriented_2nd_order.html" title="Example linear regression (2nd-order polynomial)"
             accesskey="P">previous</a> |
          <a href="run_environmental_pls-Copy1.html" title="Uncertainty in biomarker identification"
             accesskey="N">next</a> |
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 4ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Uncertainty-in-QSAR-modeling">
<h1>Uncertainty in QSAR modeling<a class="headerlink" href="#Uncertainty-in-QSAR-modeling" title="Permalink to this headline">Â¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">ml_uncertainty</span> <span class="k">as</span> <span class="nn">plu</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span>

<span class="kn">import</span> <span class="nn">sklearn.cross_decomposition</span>
<span class="kn">import</span> <span class="nn">sklearn.model_selection</span> <span class="k">as</span> <span class="nn">skcv</span>
<span class="kn">import</span> <span class="nn">sklearn.preprocessing</span> <span class="k">as</span> <span class="nn">skpp</span>
<span class="kn">import</span> <span class="nn">sklearn.metrics</span> <span class="k">as</span> <span class="nn">skmet</span>

<span class="kn">import</span> <span class="nn">math</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">plot_bootstrap_pls</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span><span class="n">y_train</span><span class="p">,</span><span class="n">test_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">y_test</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">axes_row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">train_colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">test_colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">group</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="n">num_train</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
    <span class="n">num_test</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">test_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">num_test</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
    <span class="n">num_total</span> <span class="o">=</span> <span class="n">num_train</span> <span class="o">+</span> <span class="n">num_test</span>

    <span class="k">if</span> <span class="n">train_colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">train_colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_train</span><span class="p">)</span>
        <span class="n">train_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">train_colors</span><span class="p">)</span>
        <span class="n">train_colors</span><span class="p">[</span><span class="n">y_train</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
    <span class="k">if</span> <span class="n">test_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">test_colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">test_colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_test</span><span class="p">)</span>
            <span class="n">test_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test_colors</span><span class="p">)</span>
            <span class="n">test_colors</span><span class="p">[</span><span class="n">y_test</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>

    <span class="n">errbar_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">zorder</span><span class="o">=-</span><span class="mi">100</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1">#Get the median of the bootstrap data</span>
    <span class="n">train_predict</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1">#Confidence limits and errorbar widths</span>
    <span class="n">ci_upper_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span><span class="mf">97.5</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ci_lower_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span><span class="mf">2.5</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">error_train</span> <span class="o">=</span> <span class="p">(</span><span class="n">ci_upper_train</span> <span class="o">-</span> <span class="n">ci_lower_train</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

    <span class="k">if</span> <span class="n">test_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">test_predict</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ci_upper_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span><span class="mf">97.5</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ci_lower_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span><span class="mf">2.5</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">error_test</span> <span class="o">=</span> <span class="p">(</span><span class="n">ci_upper_test</span> <span class="o">-</span> <span class="n">ci_lower_test</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

    <span class="c1">#Class boundary value and line formatting</span>
    <span class="n">cv</span> <span class="o">=</span> <span class="n">plu</span><span class="o">.</span><span class="n">estimate_class_boundary</span><span class="p">(</span><span class="n">train_predict</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
    <span class="n">class_boundary_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=-</span><span class="mi">100</span><span class="p">)</span>

    <span class="c1">#Pearson R value</span>
    <span class="c1">#Pearson R on the test data if available, otherwise on the training data</span>
    <span class="k">if</span> <span class="n">test_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">r2</span><span class="o">=</span><span class="n">skmet</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">test_predict</span><span class="p">)</span>
        <span class="c1">#r,p = scipy.stats.pearsonr(y_test,test_predict)</span>
        <span class="n">residual</span><span class="p">,</span><span class="n">err</span><span class="p">,</span><span class="n">mse</span> <span class="o">=</span> <span class="n">plu</span><span class="o">.</span><span class="n">get_residual_stats</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">test_predict</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">r2</span><span class="o">=</span><span class="n">skmet</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">train_predict</span><span class="p">)</span>
        <span class="c1">#r,p = scipy.stats.pearsonr(y_train,train_predict)</span>
        <span class="n">residual</span><span class="p">,</span><span class="n">err</span><span class="p">,</span><span class="n">mse</span> <span class="o">=</span> <span class="n">plu</span><span class="o">.</span><span class="n">get_residual_stats</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">train_predict</span><span class="p">)</span>

    <span class="c1">#r2 = r ** 2</span>
    <span class="n">rstring</span> <span class="o">=</span> <span class="s1">&#39;$r^2$ = </span><span class="si">{: 5.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span>

    <span class="c1">#Misclassification probabilities and training set confidences</span>
    <span class="n">prob_zero_train</span> <span class="o">=</span> <span class="n">plu</span><span class="o">.</span><span class="n">get_probabilities</span><span class="p">(</span><span class="n">class_predicted</span><span class="o">=</span><span class="n">train_predict</span><span class="p">,</span><span class="n">data_error</span><span class="o">=</span><span class="n">error_train</span><span class="p">,</span><span class="n">class_value</span><span class="o">=</span><span class="n">cv</span><span class="p">)</span>
    <span class="n">train_assigned</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">train_predict</span><span class="p">)</span>
    <span class="n">train_assigned</span><span class="p">[</span><span class="n">train_predict</span> <span class="o">&gt;</span> <span class="n">cv</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">misclass</span><span class="p">,</span><span class="n">misclass_mask_train</span> <span class="o">=</span> <span class="n">plu</span><span class="o">.</span><span class="n">find_misclassified</span><span class="p">(</span><span class="n">true_class</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span><span class="n">assigned_class</span><span class="o">=</span><span class="n">train_assigned</span><span class="p">)</span>
    <span class="n">train_confidence</span> <span class="o">=</span> <span class="n">plu</span><span class="o">.</span><span class="n">misclass_probability</span><span class="p">(</span><span class="n">prob_zero_train</span><span class="p">,</span><span class="n">misclass_mask_train</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">test_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prob_zero</span> <span class="o">=</span> <span class="n">plu</span><span class="o">.</span><span class="n">get_probabilities</span><span class="p">(</span><span class="n">class_predicted</span><span class="o">=</span><span class="n">test_predict</span><span class="p">,</span><span class="n">data_error</span><span class="o">=</span><span class="n">error_test</span><span class="p">,</span><span class="n">class_value</span><span class="o">=</span><span class="n">cv</span><span class="p">)</span>
        <span class="n">test_assigned</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">test_predict</span><span class="p">)</span>
        <span class="n">test_assigned</span><span class="p">[</span><span class="n">test_predict</span> <span class="o">&gt;</span> <span class="n">cv</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">misclass_test</span><span class="p">,</span><span class="n">misclass_mask_test</span> <span class="o">=</span> <span class="n">plu</span><span class="o">.</span><span class="n">find_misclassified</span><span class="p">(</span><span class="n">true_class</span><span class="o">=</span><span class="n">yt</span><span class="p">,</span><span class="n">assigned_class</span><span class="o">=</span><span class="n">test_assigned</span><span class="p">)</span>
        <span class="n">test_confidence</span> <span class="o">=</span> <span class="n">plu</span><span class="o">.</span><span class="n">misclass_probability</span><span class="p">(</span><span class="n">prob_zero</span><span class="p">,</span><span class="n">misclass_mask_test</span><span class="p">)</span>

    <span class="n">train_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">prob_zero_train</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">test_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">test_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">prob_zero</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">group</span><span class="p">:</span>
        <span class="n">boot_all</span> <span class="o">=</span> <span class="n">train_data</span>
        <span class="n">class_predict</span> <span class="o">=</span> <span class="n">train_predict</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">train_colors</span>
        <span class="k">if</span> <span class="n">test_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">boot_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">boot_all</span><span class="p">,</span><span class="n">test_data</span><span class="p">))</span>
            <span class="n">class_predict</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">class_predict</span><span class="p">,</span><span class="n">test_predict</span><span class="p">))</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">train_colors</span><span class="p">,</span><span class="n">test_colors</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">boot_all</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="n">train_order</span><span class="p">]</span>
        <span class="n">class_predict</span> <span class="o">=</span> <span class="n">train_predict</span><span class="p">[</span><span class="n">train_order</span><span class="p">]</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">train_colors</span><span class="p">[</span><span class="n">train_order</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">test_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">boot_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">boot_all</span><span class="p">,</span><span class="n">test_data</span><span class="p">[</span><span class="n">test_order</span><span class="p">]))</span>
            <span class="n">class_predict</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">class_predict</span><span class="p">,</span><span class="n">test_predict</span><span class="p">[</span><span class="n">test_order</span><span class="p">]))</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">train_colors</span><span class="p">,</span><span class="n">test_colors</span><span class="p">[</span><span class="n">test_order</span><span class="p">]))</span>

    <span class="c1">#Confidence limits on the full set</span>
    <span class="n">ci_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">boot_all</span><span class="p">,</span><span class="mf">97.5</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ci_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">boot_all</span><span class="p">,</span><span class="mf">2.5</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">error</span> <span class="o">=</span> <span class="p">(</span><span class="n">ci_upper</span> <span class="o">-</span> <span class="n">ci_lower</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

    <span class="c1">#Split axes</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">mcax</span> <span class="o">=</span> <span class="n">axes_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1">#Class value plot</span>

    <span class="c1">#Axis limits for the class value plot</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">num_total</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predicted class, $XW^*Q^T$&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Sample index (a.u.)&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>

    <span class="c1">#Scatter plot and error bar plots for predicted class values</span>
    <span class="n">plsplot</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_total</span><span class="p">),</span><span class="n">class_predict</span><span class="p">,</span>
                     <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

    <span class="n">plserr</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_total</span><span class="p">),</span><span class="n">class_predict</span><span class="p">,</span>
                         <span class="n">yerr</span><span class="o">=</span><span class="n">error</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">errbar_dict</span><span class="p">)</span>
    <span class="n">pls_class_boundaryy</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span><span class="o">**</span><span class="n">class_boundary_dict</span><span class="p">)</span>

    <span class="c1">#Misclassification probability plot</span>
    <span class="n">proby_centerline</span> <span class="o">=</span> <span class="n">mcax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="o">**</span><span class="n">class_boundary_dict</span><span class="p">)</span><span class="c1">#mcax.plot((0.5,0.5),(-1.5,2.5),&#39;k:&#39;)</span>
    <span class="n">class_centerline</span> <span class="o">=</span> <span class="n">mcax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span><span class="o">**</span><span class="n">class_boundary_dict</span><span class="p">)</span> <span class="c1">#mcax.plot((-1,2),(cv,cv),&#39;k:&#39;)</span>

    <span class="c1">#Misclassification probabilities</span>
    <span class="c1">#Training set correct classification</span>

    <span class="n">mcax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">train_confidence</span><span class="p">[</span><span class="o">~</span><span class="n">misclass_mask_train</span><span class="p">],</span>
        <span class="n">train_predict</span><span class="p">[</span><span class="o">~</span><span class="n">misclass_mask_train</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Correct Train&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>

    <span class="n">mcax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="mi">1</span><span class="o">-</span><span class="n">train_confidence</span><span class="p">[</span><span class="n">misclass_mask_train</span><span class="p">],</span>
        <span class="n">train_predict</span><span class="p">[</span><span class="n">misclass_mask_train</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Incorrect Train&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">test_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mcax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">test_confidence</span><span class="p">[</span><span class="o">~</span><span class="n">misclass_mask_test</span><span class="p">],</span>
            <span class="n">test_predict</span><span class="p">[</span><span class="o">~</span><span class="n">misclass_mask_test</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Correct Test&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>

        <span class="n">mcax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="mi">1</span><span class="o">-</span><span class="n">test_confidence</span><span class="p">[</span><span class="n">misclass_mask_test</span><span class="p">],</span>
            <span class="n">test_predict</span><span class="p">[</span><span class="n">misclass_mask_test</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Incorrect Test&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">mcax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">1.05</span><span class="p">)</span>
    <span class="c1">#mcax.set_ylim(-0.05,1.05)</span>
    <span class="n">mcax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1">#mcax.set_yticks([0,0.5,1])</span>
    <span class="n">mcax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">0.95</span><span class="p">,</span><span class="n">rstring</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="n">mcax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="n">mcax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mathsf</span><span class="si">{Pr}</span><span class="s1">_\mathsf</span><span class="si">{misclass}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Read the data into a Pandas data frame</span>
<span class="n">testdata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;./Dataset.xlsx&#39;</span><span class="p">,</span><span class="n">skipfooter</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1">#External validation data</span>
<span class="n">validationdata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;./Dataset.xlsx&#39;</span><span class="p">,</span><span class="n">sheet_name</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Choose the variables for use in this study</span>
<span class="n">variables</span> <span class="o">=</span> <span class="p">[</span>
<span class="s1">&#39;SpMax_L&#39;</span><span class="p">,</span>
<span class="s1">&#39;F04[C-N]&#39;</span><span class="p">,</span>
<span class="s1">&#39;C%&#39;</span><span class="p">,</span>
<span class="s1">&#39;nO&#39;</span><span class="p">,</span>
<span class="s1">&#39;HyWi_B(m)&#39;</span><span class="p">,</span>
<span class="s1">&#39;LOC&#39;</span><span class="p">,</span>
<span class="s1">&#39;SM6_L&#39;</span><span class="p">,</span>
<span class="s1">&#39;F03[C-O]&#39;</span><span class="p">,</span>
<span class="s1">&#39;Me&#39;</span><span class="p">,</span>
<span class="s1">&#39;Mi&#39;</span><span class="p">,</span>
<span class="s1">&#39;nN-N&#39;</span><span class="p">,</span>
<span class="s1">&#39;nArNO2&#39;</span><span class="p">,</span>
<span class="s1">&#39;nCRX3&#39;</span><span class="p">,</span>
<span class="s1">&#39;SpPosA_B(p)&#39;</span><span class="p">,</span>
<span class="s1">&#39;nCIR&#39;</span><span class="p">,</span>
<span class="s1">&#39;B01[C-Br]&#39;</span><span class="p">,</span>
<span class="s1">&#39;B03[C-Cl]&#39;</span><span class="p">,</span>
<span class="s1">&#39;N-073&#39;</span><span class="p">,</span>
<span class="s1">&#39;SpMax_A&#39;</span><span class="p">,</span>
<span class="s1">&#39;Psi_i_1d&#39;</span><span class="p">,</span>
<span class="s1">&#39;B04[C-Br]&#39;</span><span class="p">,</span>
<span class="s1">&#39;SdO&#39;</span><span class="p">,</span>
<span class="s1">&#39;TI2_L&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Test and calibration data</span>
<span class="n">alldata</span> <span class="o">=</span> <span class="n">testdata</span><span class="p">[</span><span class="n">variables</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="c1">#External validation data</span>
<span class="n">allvdata</span> <span class="o">=</span> <span class="n">validationdata</span><span class="p">[</span><span class="n">variables</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1">#Identify the training set</span>
<span class="n">train_mask</span> <span class="o">=</span> <span class="n">testdata</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="s1">&#39;Train&#39;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Autoscale the X data for partial least squares</span>
<span class="n">complete_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">alldata</span><span class="p">,</span><span class="n">allvdata</span><span class="p">))</span>

<span class="n">data_scaler</span> <span class="o">=</span> <span class="n">skpp</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">data_scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">complete_data</span><span class="p">)</span>

<span class="n">alldata_scale</span> <span class="o">=</span> <span class="n">data_scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">alldata</span><span class="p">)</span>
<span class="n">allvdata_scale</span> <span class="o">=</span> <span class="n">data_scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">allvdata</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Split the data into the training and test sets</span>
<span class="n">train_data_scale</span> <span class="o">=</span> <span class="n">alldata_scale</span><span class="p">[</span><span class="n">train_mask</span><span class="p">]</span>
<span class="n">test_data_scale</span> <span class="o">=</span> <span class="n">alldata_scale</span><span class="p">[</span><span class="o">~</span><span class="n">train_mask</span><span class="p">]</span>

<span class="c1">#Determine the size of the training, test, and external validation sets</span>
<span class="n">num_train</span> <span class="o">=</span> <span class="n">train_data_scale</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">num_test</span> <span class="o">=</span> <span class="n">test_data_scale</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">num_valid</span> <span class="o">=</span> <span class="n">allvdata_scale</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">labeler</span> <span class="o">=</span> <span class="n">skpp</span><span class="o">.</span><span class="n">LabelBinarizer</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">testdata</span><span class="p">[</span><span class="s1">&#39;Class&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">train_mask</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(837,)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">labeler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">([</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;NRB&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>array([[1],
       [0]])
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">labeler</span><span class="o">.</span><span class="n">classes_</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>array([&#39;NRB&#39;, &#39;RB&#39;], dtype=&#39;&lt;U3&#39;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">class_y_train</span> <span class="o">=</span> <span class="n">labeler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">testdata</span><span class="p">[</span><span class="s1">&#39;Class&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">train_mask</span><span class="p">])</span>
<span class="n">class_y_test</span> <span class="o">=</span> <span class="n">labeler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">testdata</span><span class="p">[</span><span class="s1">&#39;Class&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">~</span><span class="n">train_mask</span><span class="p">])</span>
<span class="n">class_y_valid</span> <span class="o">=</span> <span class="n">labeler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">validationdata</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Create the PLS regressors and cross_validation structure</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">model_selection</span><span class="o">.</span><span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

<span class="n">PLS_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1500</span><span class="p">)</span>
<span class="n">PLS_regressor</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">cross_decomposition</span><span class="o">.</span><span class="n">PLSRegression</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">samples</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">PLS_bootstrap</span> <span class="o">=</span> <span class="n">plu</span><span class="o">.</span><span class="n">bootstrap_estimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">PLS_regressor</span><span class="p">,</span><span class="n">estimator_kw</span><span class="o">=</span><span class="n">PLS_dict</span><span class="p">,</span>
                                        <span class="n">X</span><span class="o">=</span><span class="n">train_data_scale</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">class_y_train</span><span class="p">,</span>
                                        <span class="n">samples</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span><span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
                                       <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">PLS_bootstrap</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Calibration set</span>
<span class="n">ypred</span><span class="p">,</span><span class="n">ypboot</span><span class="p">,</span><span class="n">bounds</span><span class="p">,</span><span class="n">ci_boot</span><span class="p">,</span> <span class="o">=</span> <span class="n">PLS_bootstrap</span><span class="o">.</span><span class="n">bootstrap_uncertainty_bounds</span><span class="p">()</span>
<span class="n">error_train</span> <span class="o">=</span> <span class="n">ci_boot</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1">#Validation set</span>
<span class="n">ypval</span><span class="p">,</span><span class="n">yvboot</span><span class="p">,</span><span class="n">vbounds</span><span class="p">,</span><span class="n">ci_test</span> <span class="o">=</span> <span class="n">PLS_bootstrap</span><span class="o">.</span><span class="n">bootstrap_uncertainty_bounds</span><span class="p">(</span><span class="n">test_data_scale</span><span class="p">)</span>
<span class="n">error_test</span> <span class="o">=</span> <span class="n">ci_test</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1">#External validation</span>
<span class="n">ypex</span><span class="p">,</span><span class="n">yexboot</span><span class="p">,</span><span class="n">exbounds</span><span class="p">,</span><span class="n">ci_valid</span> <span class="o">=</span> <span class="n">PLS_bootstrap</span><span class="o">.</span><span class="n">bootstrap_uncertainty_bounds</span><span class="p">(</span><span class="n">allvdata_scale</span><span class="p">)</span>
<span class="n">error_valid</span> <span class="o">=</span> <span class="n">ci_valid</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">class_value</span> <span class="o">=</span> <span class="n">plu</span><span class="o">.</span><span class="n">estimate_class_boundary</span><span class="p">(</span><span class="n">ypred</span><span class="p">,</span><span class="n">class_y_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">class_value</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.4034978031213715
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#class_predicted_train = np.squeeze(ypred)</span>


<span class="n">class_assigned_train</span><span class="p">,</span><span class="n">class_predicted_train</span> <span class="o">=</span> <span class="n">plu</span><span class="o">.</span><span class="n">class_assignment</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ypred</span><span class="p">)</span>
<span class="n">class_assigned_test</span><span class="p">,</span><span class="n">class_predicted_test</span> <span class="o">=</span> <span class="n">plu</span><span class="o">.</span><span class="n">class_assignment</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ypval</span><span class="p">)</span>
<span class="n">class_assigned_valid</span><span class="p">,</span><span class="n">class_predicted_valid</span> <span class="o">=</span> <span class="n">plu</span><span class="o">.</span><span class="n">class_assignment</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ypex</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">class_assigned_train</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(837, 1)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">class_predicted_train</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(837, 1)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">probabilities_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">class_value</span><span class="o">=</span><span class="n">class_value</span><span class="p">)</span>
<span class="n">probability_zero_train</span> <span class="o">=</span> <span class="n">plu</span><span class="o">.</span><span class="n">get_probabilities</span><span class="p">(</span><span class="n">class_predicted</span><span class="o">=</span><span class="n">ypred</span><span class="p">,</span>
                                                <span class="n">data_error</span><span class="o">=</span><span class="n">error_train</span><span class="p">,</span>
                                                <span class="o">**</span><span class="n">probabilities_dict</span><span class="p">)</span>
<span class="n">probability_zero_test</span> <span class="o">=</span> <span class="n">plu</span><span class="o">.</span><span class="n">get_probabilities</span><span class="p">(</span><span class="n">class_predicted</span><span class="o">=</span><span class="n">ypval</span><span class="p">,</span>
                                                <span class="n">data_error</span><span class="o">=</span><span class="n">error_test</span><span class="p">,</span>
                                                <span class="o">**</span><span class="n">probabilities_dict</span><span class="p">)</span>
<span class="n">probability_zero_valid</span> <span class="o">=</span> <span class="n">plu</span><span class="o">.</span><span class="n">get_probabilities</span><span class="p">(</span><span class="n">class_predicted</span><span class="o">=</span><span class="n">ypex</span><span class="p">,</span>
                                                <span class="n">data_error</span><span class="o">=</span><span class="n">error_valid</span><span class="p">,</span>
                                                <span class="o">**</span><span class="n">probabilities_dict</span><span class="p">)</span>

<span class="n">misclass_train</span><span class="p">,</span><span class="n">misclass_mask_train</span> <span class="o">=</span> <span class="n">plu</span><span class="o">.</span><span class="n">find_misclassified</span><span class="p">(</span><span class="n">true_class</span><span class="o">=</span><span class="n">class_y_train</span><span class="p">,</span>
                                                        <span class="n">assigned_class</span><span class="o">=</span><span class="n">class_assigned_train</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">misclass_test</span><span class="p">,</span><span class="n">misclass_mask_test</span> <span class="o">=</span> <span class="n">plu</span><span class="o">.</span><span class="n">find_misclassified</span><span class="p">(</span><span class="n">true_class</span><span class="o">=</span><span class="n">class_y_test</span><span class="p">,</span>
                                                      <span class="n">assigned_class</span><span class="o">=</span><span class="n">class_assigned_test</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">misclass_valid</span><span class="p">,</span><span class="n">misclass_mask_valid</span> <span class="o">=</span> <span class="n">plu</span><span class="o">.</span><span class="n">find_misclassified</span><span class="p">(</span><span class="n">true_class</span><span class="o">=</span><span class="n">class_y_valid</span><span class="p">,</span>
                                                        <span class="n">assigned_class</span><span class="o">=</span><span class="n">class_assigned_valid</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

<span class="n">train_confidence</span> <span class="o">=</span> <span class="n">plu</span><span class="o">.</span><span class="n">misclass_probability</span><span class="p">(</span><span class="n">probability_zero_train</span><span class="p">,</span><span class="n">misclass_mask_train</span><span class="p">)</span>
<span class="n">test_confidence</span> <span class="o">=</span> <span class="n">plu</span><span class="o">.</span><span class="n">misclass_probability</span><span class="p">(</span><span class="n">probability_zero_test</span><span class="p">,</span><span class="n">misclass_mask_test</span><span class="p">)</span>
<span class="n">valid_confidence</span> <span class="o">=</span><span class="n">plu</span><span class="o">.</span><span class="n">misclass_probability</span><span class="p">(</span><span class="n">probability_zero_valid</span><span class="p">,</span><span class="n">misclass_mask_valid</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sorted_indices_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">probability_zero_train</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sorted_indices_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">probability_zero_test</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sorted_indices_valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">probability_zero_valid</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">inverse_sort_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">sorted_indices_train</span><span class="p">)</span>
<span class="n">inverse_sort_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">sorted_indices_test</span><span class="p">)</span>
<span class="n">inverse_sort_valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">sorted_indices_valid</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">errbar_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">zorder</span><span class="o">=-</span><span class="mi">100</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">boundary_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="s1">&#39;5&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=-</span><span class="mi">100</span><span class="p">)</span>
<span class="n">fs</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">plot_classification</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span>
                        <span class="n">x_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">y_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">y_err</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">class_value</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">probability_zero</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">interesting_points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">fig_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">ellipse_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#88aa88&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=-</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">errbar_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;#777777&#39;</span><span class="p">,</span><span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">zorder</span><span class="o">=-</span><span class="mi">100</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">boundary_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="s1">&#39;5&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=-</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">probdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span> <span class="p">,</span><span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=-</span><span class="mi">100000</span><span class="p">)</span>

    <span class="n">num_vars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_indices</span><span class="p">)</span>

    <span class="n">pls_class_boundaryy</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">class_value</span><span class="p">,</span><span class="o">**</span><span class="n">boundary_dict</span><span class="p">)</span>
    <span class="n">plserr</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_vars</span><span class="p">),</span><span class="n">y_data</span><span class="p">[</span><span class="n">x_indices</span><span class="p">],</span>
                        <span class="n">yerr</span><span class="o">=</span><span class="n">y_err</span><span class="p">[</span><span class="n">x_indices</span><span class="p">],</span><span class="o">**</span><span class="n">errbar_dict</span><span class="p">)</span>

    <span class="n">plsplot</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_vars</span><span class="p">),</span><span class="n">y_data</span><span class="p">[</span><span class="n">x_indices</span><span class="p">],</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">x_indices</span><span class="p">],</span>
                        <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">probability_zero</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">probax</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="n">plsconf</span> <span class="o">=</span> <span class="n">probax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_vars</span><span class="p">),</span><span class="n">probability_zero</span><span class="p">[</span><span class="n">x_indices</span><span class="p">],</span><span class="o">**</span><span class="n">probdict</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">interesting_points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">inverse_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">x_indices</span><span class="p">)</span> <span class="c1">#Get the order in which the x indices have been sorted</span>
        <span class="k">for</span> <span class="n">interest_number</span><span class="p">,</span><span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">interesting_points</span><span class="p">):</span>
            <span class="n">x_location</span> <span class="o">=</span> <span class="n">inverse_sort</span><span class="p">[</span><span class="n">point</span><span class="p">]</span>
            <span class="n">y_location</span> <span class="o">=</span> <span class="n">y_data</span><span class="p">[</span><span class="n">point</span><span class="p">]</span>
            <span class="n">y_offset</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">interest_number</span><span class="p">)</span><span class="o">*</span><span class="mf">0.6</span> <span class="c1">#offset the interesting point label from the point itself. Alternate between up and down to avoid conflicts</span>
            <span class="n">y_offset</span> <span class="o">-=</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">interest_number</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">ellipse_width</span> <span class="o">=</span> <span class="n">num_vars</span> <span class="o">/</span> <span class="mf">40.0</span>
            <span class="n">ellipse_interesting</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Ellipse</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">[</span><span class="n">x_location</span><span class="p">,</span><span class="n">y_location</span><span class="p">],</span><span class="n">width</span><span class="o">=</span><span class="n">ellipse_width</span><span class="p">,</span><span class="o">**</span><span class="n">ellipse_dict</span><span class="p">)</span>
            <span class="n">plsax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">ellipse_interesting</span><span class="p">)</span>
            <span class="c1">#plsax.text(x_location,y_location+0.7-(interest_number/8.0),str(point),ha=&#39;center&#39;)</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_location</span><span class="p">,</span><span class="n">y_location</span><span class="o">+</span><span class="n">y_offset</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">point</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
               <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span><span class="c1">#,alpha=0.2))</span>


    <span class="n">axis</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">num_vars</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fig_label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.95</span><span class="p">,</span><span class="n">fig_label</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="n">axis</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">color_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;w&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">num_train</span><span class="p">)</span>
<span class="n">color_train</span><span class="p">[</span><span class="n">misclass_mask_train</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span>
<span class="n">color_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;w&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">num_test</span><span class="p">)</span>
<span class="n">color_test</span><span class="p">[</span><span class="n">misclass_mask_test</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span>
<span class="n">color_valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;w&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">num_valid</span><span class="p">)</span>
<span class="n">color_valid</span><span class="p">[</span><span class="n">misclass_mask_valid</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span>


<span class="n">plsfig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">plsfig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.07</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;Predicted class, $Y_</span><span class="si">{PLSDA}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
<span class="n">plsfig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;Probability of assignment to NRB, $P_</span><span class="si">{0}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">)</span>

<span class="n">plsax</span> <span class="o">=</span> <span class="n">plsfig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">311</span><span class="p">)</span>
<span class="n">plot_classification</span><span class="p">(</span><span class="n">plsax</span><span class="p">,</span>
                    <span class="n">x_indices</span><span class="o">=</span><span class="n">sorted_indices_train</span><span class="p">,</span>
                    <span class="n">y_data</span><span class="o">=</span><span class="n">class_predicted_train</span><span class="p">,</span><span class="n">y_err</span><span class="o">=</span><span class="n">error_train</span><span class="p">,</span>
                    <span class="n">colors</span><span class="o">=</span><span class="n">color_train</span><span class="p">,</span>
                    <span class="n">class_value</span><span class="o">=</span><span class="n">class_value</span><span class="p">,</span>
                    <span class="n">interesting_points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">probability_zero</span><span class="o">=</span><span class="n">probability_zero_train</span><span class="p">,</span><span class="n">fig_label</span><span class="o">=</span><span class="s1">&#39;Calibration&#39;</span><span class="p">,</span>
                    <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

<span class="n">black_dot</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([],[],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                                   <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Correct classification&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">white_dot</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([],[],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                                   <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Incorrect classification&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">black_scatters</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([],[],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                                  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$P_0$&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">leg</span> <span class="o">=</span> <span class="n">plsax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">black_dot</span><span class="p">,</span><span class="n">white_dot</span><span class="p">,</span><span class="n">black_scatters</span><span class="p">],</span>
                <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">framealpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">)</span>
<span class="n">leg</span><span class="o">.</span><span class="n">get_frame</span><span class="p">()</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>

<span class="n">plsax</span> <span class="o">=</span> <span class="n">plsfig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">312</span><span class="p">)</span>
<span class="n">plot_classification</span><span class="p">(</span><span class="n">plsax</span><span class="p">,</span>
                    <span class="n">x_indices</span><span class="o">=</span><span class="n">sorted_indices_test</span><span class="p">,</span>
                    <span class="n">y_data</span><span class="o">=</span><span class="n">class_predicted_test</span><span class="p">,</span><span class="n">y_err</span><span class="o">=</span><span class="n">error_test</span><span class="p">,</span>
                    <span class="n">colors</span><span class="o">=</span><span class="n">color_test</span><span class="p">,</span>
                    <span class="n">class_value</span><span class="o">=</span><span class="n">class_value</span><span class="p">,</span>
                    <span class="n">interesting_points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">probability_zero</span><span class="o">=</span><span class="n">probability_zero_test</span><span class="p">,</span><span class="n">fig_label</span><span class="o">=</span><span class="s1">&#39;Validation&#39;</span><span class="p">,</span>
                    <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">plsax</span> <span class="o">=</span> <span class="n">plsfig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">313</span><span class="p">)</span>
<span class="n">plot_classification</span><span class="p">(</span><span class="n">plsax</span><span class="p">,</span>
                    <span class="n">x_indices</span><span class="o">=</span><span class="n">sorted_indices_valid</span><span class="p">,</span>
                    <span class="n">y_data</span><span class="o">=</span><span class="n">class_predicted_valid</span><span class="p">,</span><span class="n">y_err</span><span class="o">=</span><span class="n">error_valid</span><span class="p">,</span>
                    <span class="n">colors</span><span class="o">=</span><span class="n">color_valid</span><span class="p">,</span>
                    <span class="n">class_value</span><span class="o">=</span><span class="n">class_value</span><span class="p">,</span>
                    <span class="n">interesting_points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">probability_zero</span><span class="o">=</span><span class="n">probability_zero_valid</span><span class="p">,</span><span class="n">fig_label</span><span class="o">=</span><span class="s1">&#39;External&#39;</span><span class="p">,</span>
                    <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/qsar_regression_object-oriented_25_0.png" src="_images/qsar_regression_object-oriented_25_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">scipy</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gridspec_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="n">numplots</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">fig_height</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">plsfig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">numplots</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">fig_height</span><span class="o">*</span><span class="n">numplots</span><span class="p">),</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                           <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">gridspec_kw</span><span class="o">=</span><span class="n">gridspec_kw</span><span class="p">)</span>
<span class="n">plsfig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="s1">&#39;Predicted class&#39;</span><span class="p">,</span>
              <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plsfig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\mathsf</span><span class="si">{Pr}</span><span class="s1">_\mathsf</span><span class="si">{misclass}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plsfig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Sample index (a.u.)&#39;</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="c1"># plsfig.text(0.95,0.5,u&#39;Probability of assignment to NRB, $P_{0}$&#39;,size=15,ha=&#39;center&#39;,</span>
<span class="c1">#             va=&#39;center&#39;,rotation=-90)</span>
<span class="n">boot_sets</span> <span class="o">=</span> <span class="p">[</span><span class="n">ypboot</span><span class="p">,</span><span class="n">yvboot</span><span class="p">,</span><span class="n">yexboot</span><span class="p">]</span>
<span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">class_y_train</span><span class="p">,</span><span class="n">class_y_test</span><span class="p">,</span><span class="n">class_y_valid</span><span class="p">]</span>
<span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">sorted_indices_train</span><span class="p">,</span><span class="n">sorted_indices_test</span><span class="p">,</span><span class="n">sorted_indices_valid</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">color_train</span><span class="p">,</span><span class="n">color_test</span><span class="p">,</span><span class="n">color_valid</span><span class="p">]</span>

<span class="k">for</span> <span class="n">ax_row</span><span class="p">,</span><span class="n">yp</span><span class="p">,</span><span class="n">ytrue</span><span class="p">,</span><span class="n">indx</span><span class="p">,</span><span class="n">colr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="n">boot_sets</span><span class="p">,</span><span class="n">classes</span><span class="p">,</span><span class="n">indices</span><span class="p">,</span><span class="n">colors</span><span class="p">):</span>
    <span class="n">plot_bootstrap_pls</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">yp</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">indx</span><span class="p">],</span>
                   <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">ytrue</span><span class="p">)[</span><span class="n">indx</span><span class="p">],</span>
                   <span class="n">axes_row</span><span class="o">=</span><span class="n">ax_row</span><span class="p">,</span>
                   <span class="n">train_colors</span><span class="o">=</span><span class="n">colr</span><span class="p">[</span><span class="n">indx</span><span class="p">],</span>
                   <span class="n">group</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">ax_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">plsfig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/qsar_regression_object-oriented_27_0.png" src="_images/qsar_regression_object-oriented_27_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">plot_utils</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">wt</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">gridspec_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="n">wt</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="n">numplots</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">fig_height</span> <span class="o">=</span> <span class="mi">2</span>
<span class="c1">#plsfig,axes = plt.subplots(numplots,2,figsize=(10,fig_height*numplots),facecolor=&#39;w&#39;,</span>
<span class="c1">#                           sharex=False,sharey=True,gridspec_kw=gridspec_kw)</span>
<span class="n">ps</span><span class="o">=</span><span class="p">(</span><span class="n">wt</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">gridspec_kw</span><span class="p">[</span><span class="s1">&#39;hspace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">gridspec_kw</span><span class="p">[</span><span class="s1">&#39;wspace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">plsfig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="n">plot_utils</span><span class="o">.</span><span class="n">make_grid_plot</span><span class="p">(</span><span class="n">numplots</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">plotsize</span><span class="o">=</span><span class="n">ps</span><span class="p">,</span><span class="n">xlabel_buffer</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span><span class="n">ylabel_buffer</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
                                        <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">gridspec_kw</span><span class="o">=</span><span class="n">gridspec_kw</span><span class="p">,</span><span class="n">add_buffer</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Predicted class&#39;</span><span class="p">,</span><span class="n">label_size</span><span class="o">=</span><span class="mi">20</span>
                                       <span class="p">)</span>

<span class="n">sidx_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">wt</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">wt</span><span class="p">)</span>
<span class="n">prmc_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">wt</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">wt</span><span class="p">)</span>

<span class="n">plsfig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">prmc_x</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\mathsf</span><span class="si">{Pr}</span><span class="s1">_\mathsf</span><span class="si">{misclass}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plsfig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">sidx_x</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Sample index (a.u.)&#39;</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="c1"># plsfig.text(0.95,0.5,u&#39;Probability of assignment to NRB, $P_{0}$&#39;,size=15,ha=&#39;center&#39;,</span>
<span class="c1">#             va=&#39;center&#39;,rotation=-90)</span>
<span class="n">boot_sets</span> <span class="o">=</span> <span class="p">[</span><span class="n">ypboot</span><span class="p">,</span><span class="n">yvboot</span><span class="p">,</span><span class="n">yexboot</span><span class="p">]</span>
<span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">class_y_train</span><span class="p">,</span><span class="n">class_y_test</span><span class="p">,</span><span class="n">class_y_valid</span><span class="p">]</span>
<span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">sorted_indices_train</span><span class="p">,</span><span class="n">sorted_indices_test</span><span class="p">,</span><span class="n">sorted_indices_valid</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">color_train</span><span class="p">,</span><span class="n">color_test</span><span class="p">,</span><span class="n">color_valid</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Calbration&#39;</span><span class="p">,</span><span class="s1">&#39;Validation&#39;</span><span class="p">,</span><span class="s1">&#39;External&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">ax_row</span><span class="p">,</span><span class="n">yp</span><span class="p">,</span><span class="n">ytrue</span><span class="p">,</span><span class="n">indx</span><span class="p">,</span><span class="n">colr</span><span class="p">,</span><span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="n">boot_sets</span><span class="p">,</span><span class="n">classes</span><span class="p">,</span><span class="n">indices</span><span class="p">,</span><span class="n">colors</span><span class="p">,</span><span class="n">labels</span><span class="p">):</span>
    <span class="n">plot_bootstrap_pls</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">yp</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                   <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">ytrue</span><span class="p">),</span>
                   <span class="n">axes_row</span><span class="o">=</span><span class="n">ax_row</span><span class="p">,</span>
                   <span class="n">train_colors</span><span class="o">=</span><span class="n">colr</span><span class="p">,</span>
                   <span class="n">group</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s1">&#39;NRB&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">])</span>
    <span class="n">ax_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="n">ax_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
<span class="c1">#plsfig.tight_layout()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/qsar_regression_object-oriented_29_0.png" src="_images/qsar_regression_object-oriented_29_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Make the figure</span>
<span class="n">fs1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">gridspec_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">fs1</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">gridspec_kw</span><span class="o">=</span><span class="n">gridspec_kw</span><span class="p">)</span>

<span class="n">plot_bootstrap_pls</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">ypboot</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">sorted_indices_train</span><span class="p">],</span>
                   <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">class_y_train</span><span class="p">)[</span><span class="n">sorted_indices_train</span><span class="p">],</span>
                   <span class="n">axes_row</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
                   <span class="n">train_colors</span><span class="o">=</span><span class="n">color_train</span><span class="p">[</span><span class="n">sorted_indices_train</span><span class="p">],</span>
                   <span class="n">group</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/qsar_regression_object-oriented_30_0.png" src="_images/qsar_regression_object-oriented_30_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Make the figure</span>
<span class="n">fs1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">gridspec_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">fs1</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">gridspec_kw</span><span class="o">=</span><span class="n">gridspec_kw</span><span class="p">)</span>

<span class="n">plot_bootstrap_pls</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">yvboot</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">sorted_indices_test</span><span class="p">],</span>
                   <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">class_y_test</span><span class="p">)[</span><span class="n">sorted_indices_test</span><span class="p">],</span>
                   <span class="n">axes_row</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
                   <span class="n">train_colors</span><span class="o">=</span><span class="n">color_test</span><span class="p">[</span><span class="n">sorted_indices_test</span><span class="p">],</span>
                   <span class="n">group</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/qsar_regression_object-oriented_31_0.png" src="_images/qsar_regression_object-oriented_31_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Make the figure</span>
<span class="n">fs1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">gridspec_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">fs1</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">gridspec_kw</span><span class="o">=</span><span class="n">gridspec_kw</span><span class="p">)</span>

<span class="n">plot_bootstrap_pls</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">yexboot</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">sorted_indices_valid</span><span class="p">],</span>
                   <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">class_y_valid</span><span class="p">)[</span><span class="n">sorted_indices_valid</span><span class="p">],</span>
                   <span class="n">axes_row</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
                   <span class="n">train_colors</span><span class="o">=</span><span class="n">color_valid</span><span class="p">[</span><span class="n">sorted_indices_valid</span><span class="p">],</span>
                   <span class="n">group</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/qsar_regression_object-oriented_32_0.png" src="_images/qsar_regression_object-oriented_32_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">train_plot_dict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x_indices</span><span class="o">=</span><span class="n">sorted_indices_train</span><span class="p">,</span>
                    <span class="n">y_data</span><span class="o">=</span><span class="n">class_predicted_train</span><span class="p">,</span><span class="n">y_err</span><span class="o">=</span><span class="n">error_train</span><span class="p">,</span>
                    <span class="n">colors</span><span class="o">=</span><span class="n">color_train</span><span class="p">,</span>
                    <span class="n">class_value</span><span class="o">=</span><span class="n">class_value</span><span class="p">,</span>
                    <span class="n">interesting_points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">probability_zero</span><span class="o">=</span><span class="n">probability_zero_train</span><span class="p">,</span><span class="n">fig_label</span><span class="o">=</span><span class="s1">&#39;Calibration&#39;</span><span class="p">,</span>
                    <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">test_plot_dict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x_indices</span><span class="o">=</span><span class="n">sorted_indices_test</span><span class="p">,</span>
                    <span class="n">y_data</span><span class="o">=</span><span class="n">class_predicted_test</span><span class="p">,</span><span class="n">y_err</span><span class="o">=</span><span class="n">error_test</span><span class="p">,</span>
                    <span class="n">colors</span><span class="o">=</span><span class="n">color_test</span><span class="p">,</span>
                    <span class="n">class_value</span><span class="o">=</span><span class="n">class_value</span><span class="p">,</span>
                    <span class="n">interesting_points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">probability_zero</span><span class="o">=</span><span class="n">probability_zero_test</span><span class="p">,</span><span class="n">fig_label</span><span class="o">=</span><span class="s1">&#39;Validation&#39;</span><span class="p">,</span>
                    <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">valid_plot_dict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x_indices</span><span class="o">=</span><span class="n">sorted_indices_valid</span><span class="p">,</span>
                    <span class="n">y_data</span><span class="o">=</span><span class="n">class_predicted_valid</span><span class="p">,</span><span class="n">y_err</span><span class="o">=</span><span class="n">error_valid</span><span class="p">,</span>
                    <span class="n">colors</span><span class="o">=</span><span class="n">color_valid</span><span class="p">,</span>
                    <span class="n">class_value</span><span class="o">=</span><span class="n">class_value</span><span class="p">,</span>
                    <span class="n">interesting_points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">probability_zero</span><span class="o">=</span><span class="n">probability_zero_valid</span><span class="p">,</span><span class="n">fig_label</span><span class="o">=</span><span class="s1">&#39;External&#39;</span><span class="p">,</span>
                    <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">numplots</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">fig_height</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">plsfig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">numplots</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">fig_height</span><span class="o">*</span><span class="n">numplots</span><span class="p">),</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">plsfig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.07</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;Predicted class, $Y_</span><span class="si">{PLSDA}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
<span class="n">plsfig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;Probability of assignment to NRB, $P_</span><span class="si">{0}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span><span class="n">class_dict</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,[</span><span class="n">train_plot_dict</span><span class="p">,</span><span class="n">test_plot_dict</span><span class="p">,</span><span class="n">valid_plot_dict</span><span class="p">]):</span>
    <span class="n">plot_classification</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="o">**</span><span class="n">class_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/qsar_regression_object-oriented_34_0.png" src="_images/qsar_regression_object-oriented_34_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plsfig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">plsax</span> <span class="o">=</span> <span class="n">plsfig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="n">proby_centerline</span> <span class="o">=</span> <span class="n">plsax</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">),(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">class_centerline</span> <span class="o">=</span> <span class="n">plsax</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">class_value</span><span class="p">,</span><span class="n">class_value</span><span class="p">),(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>

<span class="n">plsax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">class_predicted_train</span><span class="p">[</span><span class="o">~</span><span class="n">misclass_mask_train</span><span class="p">],</span>
    <span class="n">train_confidence</span><span class="p">[</span><span class="o">~</span><span class="n">misclass_mask_train</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Correct Calibration&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plsax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">class_predicted_train</span><span class="p">[</span><span class="n">misclass_mask_train</span><span class="p">],</span>
    <span class="mi">1</span><span class="o">-</span><span class="n">train_confidence</span><span class="p">[</span><span class="n">misclass_mask_train</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Incorrect Calibration&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">plsax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">class_predicted_test</span><span class="p">[</span><span class="o">~</span><span class="n">misclass_mask_test</span><span class="p">],</span>
    <span class="n">test_confidence</span><span class="p">[</span><span class="o">~</span><span class="n">misclass_mask_test</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Correct Validation&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plsax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">class_predicted_test</span><span class="p">[</span><span class="n">misclass_mask_test</span><span class="p">],</span>
    <span class="mi">1</span><span class="o">-</span><span class="n">test_confidence</span><span class="p">[</span><span class="n">misclass_mask_test</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Incorrect Validation&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">plsax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">class_predicted_valid</span><span class="p">[</span><span class="o">~</span><span class="n">misclass_mask_valid</span><span class="p">],</span>
    <span class="n">valid_confidence</span><span class="p">[</span><span class="o">~</span><span class="n">misclass_mask_valid</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Correct External&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;#8888ff&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">plsax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">class_predicted_valid</span><span class="p">[</span><span class="n">misclass_mask_valid</span><span class="p">],</span>
    <span class="mi">1</span><span class="o">-</span><span class="n">valid_confidence</span><span class="p">[</span><span class="n">misclass_mask_valid</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Incorrect External&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;#ff8888&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>

<span class="n">plsax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">plsax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">1.05</span><span class="p">)</span>
<span class="n">plsax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">))</span>



<span class="n">plsax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;Predicted class, $Y_</span><span class="si">{PLSDA}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ylabel</span><span class="o">=</span> <span class="n">plsax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Misclassification probability, $P_</span><span class="si">{misclass}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/qsar_regression_object-oriented_35_0.png" src="_images/qsar_regression_object-oriented_35_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">loadings_boot</span> <span class="o">=</span> <span class="p">[</span><span class="n">est</span><span class="o">.</span><span class="n">x_loadings_</span> <span class="k">for</span> <span class="n">est</span> <span class="ow">in</span> <span class="n">PLS_bootstrap</span><span class="o">.</span><span class="n">estimators_</span><span class="p">]</span>
<span class="n">loadings_boot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">loadings_boot</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">T_train</span><span class="p">,</span><span class="n">T_train_boot</span> <span class="o">=</span> <span class="n">PLS_bootstrap</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train_data_scale</span><span class="p">,</span><span class="n">with_boot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">T_test</span><span class="p">,</span><span class="n">T_test_boot</span> <span class="o">=</span> <span class="n">PLS_bootstrap</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_data_scale</span><span class="p">,</span><span class="n">with_boot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">T_train</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(837, 5)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plsfig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="n">P</span> <span class="o">=</span> <span class="n">PLS_bootstrap</span><span class="o">.</span><span class="n">base_estimator_</span><span class="o">.</span><span class="n">x_loadings_</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">PLS_bootstrap</span><span class="o">.</span><span class="n">base_estimator_</span><span class="o">.</span><span class="n">x_scores_</span>


</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/qsar_regression_object-oriented_39_0.png" src="_images/qsar_regression_object-oriented_39_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">RB_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">class_y_train</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">RB_mask_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">class_y_test</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">RB_mask_valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">class_y_valid</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">RB_mask</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(837,)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">T_train</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">RB_mask</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>array([[-2.47966899, -0.12866677,  0.12033809, -0.7542003 , -0.99207342],
       [-2.17526113, -0.29336931,  0.82120696,  0.18616505, -0.25128187],
       [-3.2490376 ,  0.76486406,  0.15858835,  0.62913906, -1.13184015],
       ...,
       [ 2.27938394,  1.58749114,  1.77122412,  0.96928712,  0.46846473],
       [-1.52698621,  2.85984187, -1.43736162,  0.85167971, -1.84949751],
       [-1.54237317,  2.66386557, -1.43961666,  0.82674004, -1.66986465]])
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plsfig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="n">plsax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">plsax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">T_train</span><span class="p">[</span><span class="n">RB_mask</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="o">-</span><span class="n">T_train</span><span class="p">[</span><span class="n">RB_mask</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Calibration RB&quot;</span><span class="p">)</span>
<span class="n">plsax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">T_train</span><span class="p">[</span><span class="o">~</span><span class="n">RB_mask</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="o">-</span><span class="n">T_train</span><span class="p">[</span><span class="o">~</span><span class="n">RB_mask</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Calibration NRB&quot;</span><span class="p">)</span>

<span class="n">plsax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">T_test</span><span class="p">[</span><span class="n">RB_mask_test</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="o">-</span><span class="n">T_test</span><span class="p">[</span><span class="n">RB_mask_test</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Validation RB&quot;</span><span class="p">)</span>
<span class="n">plsax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">T_test</span><span class="p">[</span><span class="o">~</span><span class="n">RB_mask_test</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="o">-</span><span class="n">T_test</span><span class="p">[</span><span class="o">~</span><span class="n">RB_mask_test</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Validation NRB&quot;</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="o">-</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">loading</span> <span class="ow">in</span> <span class="n">loadings_boot</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">loading</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="o">-</span><span class="n">loading</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">varnum</span><span class="p">,</span><span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables</span><span class="p">):</span>
    <span class="k">pass</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">varnum</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="o">-</span><span class="n">P</span><span class="p">[</span><span class="n">varnum</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">var</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/qsar_regression_object-oriented_43_0.png" src="_images/qsar_regression_object-oriented_43_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">sklearn.ensemble</span> <span class="k">as</span> <span class="nn">skens</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">bagger</span> <span class="o">=</span> <span class="n">skens</span><span class="o">.</span><span class="n">BaggingRegressor</span><span class="p">(</span><span class="n">base_estimator</span><span class="o">=</span><span class="n">PLS_regressor</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="mi">1500</span><span class="p">),</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">PLS_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>dict_values([5, False, 1500])
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">bagger</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data_scale</span><span class="p">,</span><span class="n">class_y_train</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>BaggingRegressor(base_estimator=PLSRegression(copy=True, max_iter=1500, n_components=5, scale=False,
       tol=1e-06),
         bootstrap=True, bootstrap_features=False, max_features=1.0,
         max_samples=1.0, n_estimators=10000, n_jobs=1, oob_score=False,
         random_state=None, verbose=0, warm_start=False)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">y</span> <span class="o">=</span> <span class="n">bagger</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_data_scale</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">est</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_data_scale</span><span class="p">)</span> <span class="k">for</span> <span class="n">est</span> <span class="ow">in</span> <span class="n">bagger</span><span class="o">.</span><span class="n">estimators_</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">y</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(10000, 837, 1)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">fs1</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">gridspec_kw</span><span class="o">=</span><span class="n">gridspec_kw</span><span class="p">)</span>

<span class="n">plot_bootstrap_pls</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                   <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">class_y_train</span><span class="p">),</span>
                   <span class="n">axes_row</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
                   <span class="n">train_colors</span><span class="o">=</span><span class="n">color_train</span><span class="p">,</span>
                   <span class="n">group</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/qsar_regression_object-oriented_51_0.png" src="_images/qsar_regression_object-oriented_51_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Make the figure</span>
<span class="n">fs1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">gridspec_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">fs1</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">gridspec_kw</span><span class="o">=</span><span class="n">gridspec_kw</span><span class="p">)</span>

<span class="n">plot_bootstrap_pls</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">ypboot</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                   <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">class_y_train</span><span class="p">),</span>
                   <span class="n">axes_row</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
                   <span class="n">train_colors</span><span class="o">=</span><span class="n">color_train</span><span class="p">,</span>
                   <span class="n">group</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/qsar_regression_object-oriented_52_0.png" src="_images/qsar_regression_object-oriented_52_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Make the figure</span>
<span class="n">fs1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">gridspec_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">gridspec_kw</span><span class="p">[</span><span class="s1">&#39;hspace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">gridspec_kw</span><span class="p">[</span><span class="s1">&#39;wspace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">fs1</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">gridspec_kw</span><span class="o">=</span><span class="n">gridspec_kw</span><span class="p">)</span>

<span class="n">plot_bootstrap_pls</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">ypboot</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                   <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">class_y_train</span><span class="p">),</span>
                   <span class="n">axes_row</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
                   <span class="n">train_colors</span><span class="o">=</span><span class="n">color_train</span><span class="p">,</span>
                   <span class="n">group</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s1">&#39;NRB&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">texts</span><span class="p">:</span>
    <span class="n">text</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/qsar_regression_object-oriented_53_0.png" src="_images/qsar_regression_object-oriented_53_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">wt</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">gridspec_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="n">wt</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="n">numplots</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">fig_height</span> <span class="o">=</span> <span class="mi">2</span>
<span class="c1">#plsfig,axes = plt.subplots(numplots,2,figsize=(10,fig_height*numplots),facecolor=&#39;w&#39;,</span>
<span class="c1">#                           sharex=False,sharey=True,gridspec_kw=gridspec_kw)</span>
<span class="n">ps</span><span class="o">=</span><span class="p">(</span><span class="n">wt</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">gridspec_kw</span><span class="p">[</span><span class="s1">&#39;hspace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">gridspec_kw</span><span class="p">[</span><span class="s1">&#39;wspace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">plsfig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="n">plot_utils</span><span class="o">.</span><span class="n">make_grid_plot</span><span class="p">(</span><span class="n">numplots</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">plotsize</span><span class="o">=</span><span class="n">ps</span><span class="p">,</span><span class="n">xlabel_buffer</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span><span class="n">ylabel_buffer</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                                        <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">gridspec_kw</span><span class="o">=</span><span class="n">gridspec_kw</span><span class="p">,</span><span class="n">add_buffer</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Predicted class&#39;</span><span class="p">,</span><span class="n">label_size</span><span class="o">=</span><span class="mi">20</span>
                                       <span class="p">)</span>

<span class="n">sidx_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">wt</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">wt</span><span class="p">)</span>
<span class="n">prmc_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">wt</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">wt</span><span class="p">)</span>

<span class="n">plsfig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">prmc_x</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\mathsf</span><span class="si">{Pr}</span><span class="s1">_\mathsf</span><span class="si">{misclass}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plsfig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">sidx_x</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Sample index (a.u.)&#39;</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="c1"># plsfig.text(0.95,0.5,u&#39;Probability of assignment to NRB, $P_{0}$&#39;,size=15,ha=&#39;center&#39;,</span>
<span class="c1">#             va=&#39;center&#39;,rotation=-90)</span>
<span class="n">boot_sets</span> <span class="o">=</span> <span class="p">[</span><span class="n">ypboot</span><span class="p">,</span><span class="n">y</span><span class="p">,]</span>
<span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">class_y_train</span><span class="p">,</span><span class="n">class_y_test</span><span class="p">,</span><span class="n">class_y_valid</span><span class="p">]</span>
<span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">sorted_indices_train</span><span class="p">,</span><span class="n">sorted_indices_test</span><span class="p">,</span><span class="n">sorted_indices_valid</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">color_train</span><span class="p">,</span><span class="n">color_test</span><span class="p">,</span><span class="n">color_valid</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Residual bootstrap&#39;</span><span class="p">,</span><span class="s1">&#39;Bootstrap&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">ax_row</span><span class="p">,</span><span class="n">yp</span><span class="p">,</span><span class="n">ytrue</span><span class="p">,</span><span class="n">indx</span><span class="p">,</span><span class="n">colr</span><span class="p">,</span><span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="n">boot_sets</span><span class="p">,</span><span class="n">classes</span><span class="p">,</span><span class="n">indices</span><span class="p">,</span><span class="n">colors</span><span class="p">,</span><span class="n">labels</span><span class="p">):</span>
    <span class="n">plot_bootstrap_pls</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">yp</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                   <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">class_y_train</span><span class="p">),</span>
                   <span class="n">axes_row</span><span class="o">=</span><span class="n">ax_row</span><span class="p">,</span>
                   <span class="n">train_colors</span><span class="o">=</span><span class="n">color_train</span><span class="p">,</span>
                   <span class="n">group</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s1">&#39;NRB&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">])</span>
    <span class="n">ax_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="n">ax_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
<span class="c1">#plsfig.tight_layout()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/qsar_regression_object-oriented_54_0.png" src="_images/qsar_regression_object-oriented_54_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table of Contents</h3>
          <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="docs.html">Module Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="toy_regression_object-oriented.html">Example linear regression (1st-order polynomial)</a></li>
<li class="toctree-l1"><a class="reference internal" href="toy_regression_object-oriented_2nd_order.html">Example linear regression (2nd-order polynomial)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Uncertainty in QSAR modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="run_environmental_pls-Copy1.html">Uncertainty in biomarker identification</a></li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
            </form>
          </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="toy_regression_object-oriented_2nd_order.html" title="Example linear regression (2nd-order polynomial)"
              >previous</a> |
            <a href="run_environmental_pls-Copy1.html" title="Uncertainty in biomarker identification"
              >next</a> |
            <a href="genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
              <br/>
              <a href="_sources/qsar_regression_object-oriented.ipynb.txt"
                rel="nofollow">Show Source</a>
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>